<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مؤشر أداء حاسبة الاستخلاص لفرع عُمق 1.3</title>
    <script async defer src="https://apis.google.com/js/api.js"
            onload="handleClientLoad()"></script>
    <script>
        const API_KEY = 'AIzaSyD6eAikKznWps9K8GcflqPy03-L7KTUaWE';  // Your API key
        const SPREADSHEET_ID = '1bZIxAmb2-E3naVHbggvAs4nOAUi0J6XIcGMyU2Bmc5w';  // Your spreadsheet ID
        const CLIENT_ID = '1065961533552-4ukc1utf902uldqfq3nvcmrohjehbd2e.apps.googleusercontent.com';  // Your OAuth Client ID
        const SCOPE = 'https://www.googleapis.com/auth/spreadsheets';

        // Load GAPI and handle client load
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        // Initialize the API client and handle OAuth
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: SCOPE,
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
            }).then(() => {
                return gapi.auth2.getAuthInstance().signIn();  // Prompt user to sign in
            }).then(() => {
                getData();  // Fetch the data after authentication
            }).catch((error) => {
                console.error('Error initializing Google API client:', error);
            });
        }

        // Function to fetch data from the Google Sheet
        function getData() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SPREADSHEET_ID,
                range: 'Drip & COTD!A12:S',
            }).then((response) => {
                const data = response.result.values;
                if (data && data.length > 0) {
                    const filteredData = filterDataByDate(data, startDate, endDate);
                    displayData(filteredData);
                } else {
                    console.log('No data found.');
                    document.getElementById('dashboard').innerHTML = '<p>No data found in the specified range.</p>';
                }
            }).catch((error) => {
                console.error('Error fetching data from Google Sheets', error);
            });
        }

        // Display data in a table
        function displayData(data) {
            let html = `
                <table>
                    <tr>
                        <th>التاريخ</th>
                        <th>اسم الموظف</th>
                        <th>المحصول</th>
                        <th>نسبة التركيز TDS%</th>
                        <th>الفرع</th>
                        <th>الطحنة</th>
                        <th>التركيز المناسب TDS%</th>
                        <th>الاجراء</th>
                        <th>Column S (CHECKBOX)</th>
                    </tr>`;
            
            data.forEach((row, index) => {
                const checkboxValue = row[18] === 'TRUE' ? 'checked' : '';
                html += `
                    <tr>
                        <td>${row[0] || ''}</td>
                        <td>${row[1] || ''}</td>
                        <td>${row[2] || ''}</td>
                        <td>${row[3] || ''}</td>
                        <td>${row[10] || ''}</td>
                        <td>${row[11] || ''}</td>
                        <td>${row[13] || ''}</td>
                        <td>${row[16] || ''}</td>
                        <td><input type="checkbox" id="checkbox-${index}" ${checkboxValue} onclick="updateCheckbox(${index}, this.checked)"></td>
                    </tr>`;
            });

            html += '</table>';
            document.getElementById('dashboard').innerHTML = html;
        }

        // Update checkbox status in the Google Sheet
        function updateCheckbox(rowIndex, checked) {
            const checkboxValue = checked ? 'TRUE' : 'FALSE';
            const range = `S${rowIndex + 13}:S${rowIndex + 13}`;  // Adjust based on where data starts in your sheet

            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SPREADSHEET_ID,
                range: range,
                valueInputOption: 'USER_ENTERED',
                resource: {
                    values: [[checkboxValue]],
                },
            }).then((response) => {
                console.log('Checkbox updated successfully:', response);
            }).catch((error) => {
                console.error('Error updating checkbox:', error);
            });
        }
    </script>
</head>
<body>
    <h1>مؤشر أداء حاسبة الاستخلاص لفرع عُمق 1.3</h1>
    <div>
        <label for="startDate">من:</label>
        <input type="date" id="startDate" value="2024-10-13">
        <label for="endDate">إلى:</label>
        <input type="date" id="endDate" value="2024-10-14">
        <button id="applyFilter">تنفيذ</button>
    </div>
    <div id="dashboard"></div>
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مؤشر أداء حاسبة الاستخلاص لفرع عُمق 1.3</title>
  <style>
    body {
      font-family: Verdana, sans-serif;
      text-align: center;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #dddddd;
      text-align: center;
      padding: 8px;
    }
    th {
      background-color: cornflowerblue;
      color: white;
    }
    #dashboard {
      margin-top: 20px;
    }
    .filter-button {
      background-color: #99c2ff;
      padding: 10px;
      border: none;
      color: white;
      cursor: pointer;
    }
    .filter-button:hover {
      background-color: #85b3ff;
    }
  </style>
</head>
<body>

  <h1>مؤشر أداء حاسبة الاستخلاص لفرع عُمق 1.3</h1>
  <p>يقوم مؤشر الاداء بعرض العينات المرفوعة لآخر ٣٠ يوم من الاحدث الى الاقدم، والامكان تغيير المدة المحددة من خانة التاريخ.</p>
  
  <label for="startDate">من:</label>
  <input type="date" id="startDate" value="2024-10-13">
  <label for="endDate">الى:</label>
  <input type="date" id="endDate" value="2024-10-14">
  
  <button class="filter-button" id="applyFilter">تنفيذ</button>
  
  <div id="dashboard"></div>

  <script async defer src="https://apis.google.com/js/api.js" onload="handleClientLoad()"></script>
  <script src="app.js"></script>

</body>
</html>
